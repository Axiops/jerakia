<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Jerakia</title>
    
    <link rel="stylesheet" href="/css/minimal.css">
    <link rel="stylesheet" href="/css/pygment_trac.css">
    <script src="/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <headercontainer>
        <header>
        <h1>Jerakia</h1>
        <p>A versatile data lookup system</p>
        <ul>
          <li><a href="https://rubygems.org/gems/jerakia/">Download <strong>Gem</strong></a></li>
          <li><a href="https://github.com/crayfishx/jerakia">View On <strong>GitHub</strong></a></li>
          <li><a href="https://forge.puppetlabs.com/crayfishx/jerakia">Install with<strong>Puppet</strong></a></li>
        </ul>
        </header>
        <menusection>
        <li><a href="/">Home</a></li>
        <br/>
        <li><a href="/basics">Basics</a></li>
        <ul>
          <li><a href="/basics/install">Installing</a></li>
          <li><a href="/basics/configure">Configuring</a></li>
          <li><a href="/basics/lookups">Understanding Jerakia Lookups</a></li>
          <li><a href="/basics/cli">Command line interface</a></li>
        </ul>
        <li><a href="/tutorial/">Quickstart Tutorial</a></li>
        <ul>
          <li><a href="/tutorial/installing">Installing Jerakia</a></li>
          <li><a href="/tutorial/config">Configuring</a></li>
          <li><a href="/tutorial/policy">Writing a policy</a></li>
          <li><a href="/tutorial/lookup">Writing a lookup</a></li>
          <li><a href="/tutorial/data">Populating data</a></li>
          <li><a href="/tutorial/command1">Running the jerakia command</a></li>
          <li><a href="/tutorial/override">Overriding data in the hierarchy</a></li>
          <li><a href="/tutorial/puppet">Integrating with Puppet</a></li>
        </ul>
        <li><a href="/lookups">Lookups</a></li>
        <ul>
          <li><a href="/lookups/plugins">Using lookup plugins</a></li>
          <li><a class="pending" href="/pending">Hiera lookup plugin</a></li>
          <li><a class="pending" href="/pending">Writing custom lookup plugins</a></li>
        </ul>
        <li><a href="/datasources">Datasources</a></li>
        <ul>
          <li><a href="/datasources/file">File datasource</a></li>
          <li><a href="/datasources/http">HTTP datasource</a></li>
          <li><a href="/datasources/dummy">Dummy datasource</a></li>
          <li><a class="pending" href="/pending">Writing datasources</a></li>
        </ul>
        <li><a href="/pending">Response Filters</a></li>
        <ul>
          <li><a class="pending" href="/pending">Encryption response filter (eyaml)</a></li>
          <li><a class="pending" href="/pending">Substr response filter</a></li>
          <li><a class="pending" href="/pending">Writing your own reponse filters</a></li>
        </ul>



        </menusection>
      <footer>
      <br/><br/>
      <p>Sponsored by</p>
      <p><a href="http://www.enviatics.com"><img src="/images/logo_enviatics.png" alt="Enviatics"></a></p>
      <p><a href="http://baloise.github.io"><img src="/images/logo_baloise_Fotor.png" alt="baloise open source"></a></p>
      <br><br><br>
      <p><small>Hosted by <a href="https://pages.github.io">GitHub Pages</a></small></p>
      <p><small>Theme adapted from <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
        </headercontainer>
      <section>
        <h1 id="datasources">Datasources</h1>

<h2 id="file_datasource">File datasource</h2>

<p>The file data source performs hierarchical searches across YAML or JSON formatted files and searches for the lookup key</p>

<h3 id="options">Options</h3>

<ul>
<li><code>:format</code> The file format, one of :yaml and :json (other formats are pluggable)</li>

<li><code>:docroot</code> The root of the documents</li>

<li><code>:searchpath</code> An array specifying the order of hierarchical lookups. Entries starting with an alphanumerical character will be relative from <code>docroot</code>, paths starting with <code>/</code> will be absolute.</li>

<li><code>:extension</code> Overrides the default extension (eg: yml) for the file format chosen</li>

<li><code>:enable_caching</code> true or false, whether to cache the contents of files</li>
</ul>

<h3 id="example">Example</h3>
<div class='highlight'><pre><code class='language-ruby' data-lang='ruby'><span class='n'>lookup</span> <span class='ss'>:foo</span> <span class='k'>do</span>
  <span class='n'>datasource</span> <span class='ss'>:file</span><span class='p'>,</span> <span class='p'>{</span>
    <span class='ss'>:format</span> <span class='o'>=&gt;</span> <span class='ss'>:yaml</span><span class='p'>,</span>
    <span class='ss'>:docroot</span> <span class='o'>=&gt;</span> <span class='s2'>&quot;/var/lib/jerakia/data&quot;</span><span class='p'>,</span>
    <span class='ss'>:searchpath</span> <span class='o'>=&gt;</span> <span class='o'>[</span>
      <span class='n'>scope</span><span class='o'>[</span><span class='ss'>:certname</span><span class='o'>]</span><span class='p'>,</span>
      <span class='n'>scope</span><span class='o'>[</span><span class='ss'>:environment</span><span class='o'>]</span><span class='p'>,</span>
      <span class='s1'>&#39;global&#39;</span>
    <span class='o'>]</span>
  <span class='p'>}</span>
<span class='k'>end</span></code></pre></div>
<h3 id="file_system_layout">File system layout</h3>

<p>Jerakia requests consist of a lookup key and an array representing the namespace. By default the file data source will look for the lookup key in a filename based upon the <code>docroot</code>, <code>searchpath</code> and <code>namespace</code>. For example if we use the above lookup directive with the following request:</p>
<div class='highlight'><pre><code class='language-console' data-lang='console'><span class='go'>{</span>
<span class='go'>  :key       =&gt; &quot;port&quot;,</span>
<span class='go'>  :namespace =&gt; [ &quot;apache&quot; ],</span>
<span class='go'>}</span></code></pre></div>
<p>Assuming the scope has <code>certname =&gt; foo.acme.com</code> and <code>environment =&gt; development</code> then Jerakia will search for the key <code>port</code> in the following order</p>

<ul>
<li><code>/var/lib/jerakia/data/foo.acme.com/apache.yaml</code></li>

<li><code>/var/lib/jerakia/data/development/apache.yaml</code></li>

<li><code>/var/lib/jerakia/data/global/apache.yaml</code></li>
</ul>

<p>More than one element used in the namespace will just expand the filesystem hierarchy, for example <code>:namespace =&gt; [ &quot;profile&quot;, &quot;web&quot; ]</code> will result in something like <code>/var/lib/jerakia/data/global/profile/web.yaml</code></p>

<h3 id="hiera_compatibility">Hiera compatibility</h3>

<p>Hiera maps lookups to file paths slightly differently by default. If you are performing a lookup for <code>apache::port</code> from Puppet, Hiera will normally search for the key <code>apache::port</code> in a file corresponding to the hierarchy. Jerakia searches for the lookup key <code>port</code>, in the namespace <code>apache</code> and therefore will look for the key in <code>apache.yaml</code>.</p>

<p>This is illustrated here;</p>

<p><em>Hiera</em></p>
<div class='highlight'><pre><code class='language-console' data-lang='console'><span class='gp'>$</span> cat /path/to/yaml/development.yaml
<span class='go'>---</span>
<span class='go'>apache::port: 80</span></code></pre></div>
<p><em>Jerakia</em></p>
<div class='highlight'><pre><code class='language-console' data-lang='console'><span class='gp'>$</span> cat /path/to/yaml/development/apache.yaml
<span class='go'>---</span>
<span class='go'>port: 80</span></code></pre></div>
<p>Users migrating from Hiera to Jerakia or just looking to test Jerakia on their existing Hiera filesystem layout <a href="/plugins/hiera">can use the hiera plugin</a> to make the lookup rewrite the request so it gets searched in a hiera-style way.</p>

<h3 id="fragments">Fragments</h3>

<p>A useful feature of Jerakia is the ability to break down your document into multiple files, especially where a file is becomming excessivly large. The fragments feature was introduced in 0.4.0 and searches for a <em>.d</em> directory matching the full pathname (minus extension) to your data file. If found, Jerakia will concatenate the contents of all files below the <em>.d</em> directory into one document before sending it to the format handler.</p>

<p>So in this example;</p>
<div class='highlight'><pre><code class='language-console' data-lang='console'><span class='go'>/var/lib/jerakia/environment/dev/apache.yaml</span>
<span class='go'>/var/lib/jerakia/environment/dev/apache.d/01_www.example.com.yaml</span>
<span class='go'>/var/lib/jerakia/environment/dev/apache.d/01_www.foo.com.yaml</span></code></pre></div>
<p>Jerakia will first scan the <code>apache.yaml</code> file, then traverse into the directory and concatenate (in alphabetical order) all the files encountered into one YAML document. That means you can use YAML anchors across multiple files within the scope of the fragments as the YAML parser will only get one document. Note that the <code>apache.yaml</code> file will always be parsed and included first.</p>
      </section>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><!--<![endif]-->
  </body>
</html>
